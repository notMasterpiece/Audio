{"ast":null,"code":"var _jsxFileName = \"/Grawdanin/MERN/audio/client/src/components/PlayPanel/PlayPanelContainer.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { togglePlayPanel } from '../../modules/app/appActions';\nimport { playNextAudio, playAudio } from '../../modules/audio/audioAction';\nimport PlayPanel from './PlayPanel';\nconst defaultVolume = 60;\n\nclass PlayPanelContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handlePlay = () => {\n      const audio = this.state.audio;\n\n      if (audio.paused || audio.ended) {\n        audio.play();\n        this.setState({\n          isPlaying: true\n        });\n      } else {\n        audio.pause();\n        this.setState({\n          isPlaying: false\n        });\n      }\n    };\n\n    this.handlePlayNext = () => {\n      const currentAudio = this.state.currentAudio;\n      this.setState({\n        isLoading: true,\n        currentAudio: currentAudio + 1\n      }, () => {\n        const _this$state = this.state,\n              audio = _this$state.audio,\n              currentAudio = _this$state.currentAudio;\n        audio.src = this.props.audioList[currentAudio].url;\n\n        audio.onloadedmetadata = () => {\n          console.log(audio.duration);\n          this.setState({\n            isLoading: false,\n            isPlaying: true,\n            duration: audio.duration\n          });\n        };\n\n        audio.ontimeupdate = () => {\n          this.setState({\n            currentTime: audio.currentTime\n          });\n        };\n\n        audio.play();\n      });\n    };\n\n    this.handlePlayPrev = () => {\n      const currentAudio = this.state.currentAudio;\n      this.setState({\n        isLoading: true,\n        currentAudio: currentAudio - 1\n      }, () => {\n        const _this$state2 = this.state,\n              audio = _this$state2.audio,\n              currentAudio = _this$state2.currentAudio;\n        audio.src = this.props.audioList[currentAudio].url;\n\n        audio.onloadedmetadata = () => {\n          console.log(audio.duration);\n          this.setState({\n            isLoading: false,\n            isPlaying: true,\n            duration: audio.duration\n          });\n        };\n\n        audio.ontimeupdate = () => {\n          this.setState({\n            currentTime: audio.currentTime\n          });\n\n          if (audio.currentTime === audio.duration) {\n            audio.pause();\n            this.setState({\n              isPlaying: false\n            });\n          }\n        };\n\n        audio.play();\n      });\n    };\n\n    this.changeAudio = audioId => {\n      console.log(audioId);\n      const audio = this.state.audio;\n      audio.pause();\n      const player = this.props.player;\n      const newAudio = player.audioList.filter(audio => audio.id === audioId);\n      this.setState({\n        isLoading: true,\n        audio: new Audio(newAudio[0].url)\n      }, () => {\n        const audio = this.state.audio;\n\n        audio.onloadedmetadata = () => {\n          this.setState({\n            isLoading: false,\n            duration: audio.duration\n          });\n        };\n\n        audio.ontimeupdate = () => {\n          this.setState({\n            currentTime: audio.currentTime\n          });\n\n          if (audio.currentTime === audio.duration) {\n            audio.pause();\n            this.setState({\n              isPlaying: false\n            });\n          }\n        };\n\n        this.playAudio();\n      });\n    };\n\n    this.playAudio = () => {\n      const playAudio = this.props.playAudio;\n      const audio = this.state.audio;\n      playAudio();\n      audio.play();\n    };\n\n    this.changeVolume = value => {\n      const audio = this.state.audio;\n      this.setState({\n        volume: value\n      });\n      audio.volume = value / 100;\n    };\n\n    this.handleAudioLoop = () => {\n      const _this$state3 = this.state,\n            audio = _this$state3.audio,\n            loop = _this$state3.loop;\n\n      if (loop) {\n        audio.loop = false;\n        this.setState({\n          loop: false\n        });\n      } else {\n        audio.loop = true;\n        this.setState({\n          loop: true\n        });\n      }\n    };\n\n    this.setAudioDuration = currentTime => {\n      const audio = this.state.audio;\n      this.setState({\n        currentTime\n      });\n      audio.currentTime = currentTime;\n    };\n\n    this.state = {\n      audio: null,\n      audioId: this.props.audioId,\n      duration: 0,\n      currentTime: 0,\n      isPlaying: this.props.isPlaying,\n      isLoading: true,\n      volume: defaultVolume,\n      loop: false\n    };\n  }\n\n  componentDidUpdate(prevProps, state) {\n    // console.log(this.props.audio, 'this.props');\n    // console.log(prevProps.audio);\n    if (!this.props.player.isPlaying) {\n      if (state.audio && !state.audio.paused) {\n        state.audio.pause();\n      }\n    }\n\n    if (this.props.player.audioId !== prevProps.player.audioId) {\n      this.changeAudio(this.props.player.audioId);\n    }\n  }\n\n  componentDidMount() {\n    const _this$props$player = this.props.player,\n          audioList = _this$props$player.audioList,\n          audioId = _this$props$player.audioId;\n    const newAudio = audioList.filter(audio => audio.id === audioId);\n    this.setState({\n      audio: new Audio(newAudio[0].url)\n    }, () => {\n      const audio = this.state.audio;\n\n      audio.onloadedmetadata = () => {\n        this.setState({\n          isLoading: false,\n          duration: audio.duration\n        });\n      };\n\n      audio.ontimeupdate = () => {\n        this.setState({\n          currentTime: audio.currentTime\n        });\n\n        if (audio.currentTime === audio.duration) {\n          audio.pause();\n          this.setState({\n            isPlaying: false\n          });\n        }\n      };\n    });\n  }\n\n  render() {\n    const _this$state4 = this.state,\n          audio = _this$state4.audio,\n          isPlaying = _this$state4.isPlaying,\n          volume = _this$state4.volume,\n          isLoading = _this$state4.isLoading,\n          duration = _this$state4.duration,\n          currentTime = _this$state4.currentTime,\n          loop = _this$state4.loop;\n    const _this$props = this.props,\n          togglePlayPanel = _this$props.togglePlayPanel,\n          showPlayPanel = _this$props.showPlayPanel,\n          player = _this$props.player;\n    return React.createElement(PlayPanel, {\n      isLoading: isLoading,\n      currentAudioObj: player.audioList.filter(audio => audio.id === player.audioId),\n      audio: audio,\n      isPlaying: isPlaying,\n      handlePlay: this.handlePlay,\n      handlePlayNext: this.handlePlayNext,\n      handlePlayPrev: this.handlePlayPrev,\n      defaultVolume: defaultVolume,\n      volume: volume,\n      changeVolume: this.changeVolume,\n      duration: duration,\n      currentTime: currentTime,\n      loop: loop,\n      handleAudioLoop: this.handleAudioLoop,\n      setAudioDuration: this.setAudioDuration,\n      togglePlayPanel: togglePlayPanel,\n      showPlayPanel: showPlayPanel,\n      player: player // audioPlayer={audioPlayer}\n      // handleMetadata={handleMetadata}\n      // handleTimeupdate={handleTimeupdate}\n      // currentTrackMoment={currentTrackMoment}\n      // currentTrackDuration={currentTrackDuration}\n      // currentAudio={currentAudio}\n      ,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    });\n  }\n\n}\n\nPlayPanelContainer.propTypes = {\n  player: PropTypes.object,\n  playNextAudio: PropTypes.func\n};\nexport default connect(state => ({\n  player: state.player,\n  showPlayPanel: state.app.showPlayPanel\n}), {\n  playNextAudio,\n  togglePlayPanel,\n  playAudio\n})(PlayPanelContainer);","map":{"version":3,"sources":["/Grawdanin/MERN/audio/client/src/components/PlayPanel/PlayPanelContainer.js"],"names":["React","Component","PropTypes","connect","togglePlayPanel","playNextAudio","playAudio","PlayPanel","defaultVolume","PlayPanelContainer","constructor","props","handlePlay","audio","state","paused","ended","play","setState","isPlaying","pause","handlePlayNext","currentAudio","isLoading","src","audioList","url","onloadedmetadata","console","log","duration","ontimeupdate","currentTime","handlePlayPrev","changeAudio","audioId","player","newAudio","filter","id","Audio","changeVolume","value","volume","handleAudioLoop","loop","setAudioDuration","componentDidUpdate","prevProps","componentDidMount","render","showPlayPanel","propTypes","object","func","app"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {connect} from 'react-redux';\nimport {togglePlayPanel} from '../../modules/app/appActions';\nimport {playNextAudio, playAudio} from '../../modules/audio/audioAction';\n\nimport PlayPanel from './PlayPanel';\n\nconst defaultVolume = 60;\n\nclass PlayPanelContainer extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            audio: null,\n            audioId: this.props.audioId,\n            duration: 0,\n            currentTime: 0,\n            isPlaying: this.props.isPlaying,\n            isLoading: true,\n            volume: defaultVolume,\n            loop: false\n        };\n    }\n\n\n    handlePlay = () => {\n        const {audio} = this.state;\n\n        if (audio.paused || audio.ended) {\n            audio.play();\n            this.setState({isPlaying: true});\n        } else {\n            audio.pause();\n            this.setState({isPlaying: false});\n        }\n    };\n\n\n    // getMetadata = () => {\n    //     const {audio} = this.state;\n    //     const duration = Math.floor(audio.duration);\n    //     console.log(duration);\n    // };\n\n\n    handlePlayNext = () => {\n        const {currentAudio} = this.state;\n        this.setState({\n            isLoading: true,\n            currentAudio: currentAudio + 1\n        }, () => {\n\n            const {audio, currentAudio} = this.state;\n            audio.src = this.props.audioList[currentAudio].url;\n\n            audio.onloadedmetadata = () => {\n                console.log(audio.duration);\n                this.setState({\n                    isLoading: false,\n                    isPlaying: true,\n                    duration: audio.duration\n                })\n            };\n            audio.ontimeupdate = () => {\n                this.setState({\n                    currentTime: audio.currentTime\n                })\n            };\n            audio.play();\n        });\n\n    };\n\n\n    handlePlayPrev = () => {\n        const {currentAudio} = this.state;\n        this.setState({\n            isLoading: true,\n            currentAudio: currentAudio - 1\n        }, () => {\n\n            const {audio, currentAudio} = this.state;\n            audio.src = this.props.audioList[currentAudio].url;\n\n            audio.onloadedmetadata = () => {\n                console.log(audio.duration);\n                this.setState({\n                    isLoading: false,\n                    isPlaying: true,\n                    duration: audio.duration\n                })\n            };\n            audio.ontimeupdate = () => {\n                this.setState({\n                    currentTime: audio.currentTime\n                });\n                if (audio.currentTime === audio.duration) {\n                    audio.pause();\n                    this.setState({isPlaying: false});\n                }\n            };\n            audio.play();\n        });\n\n    };\n\n\n    componentDidUpdate(prevProps, state) {\n        // console.log(this.props.audio, 'this.props');\n        // console.log(prevProps.audio);\n\n        if (!this.props.player.isPlaying) {\n\n            if (state.audio && !state.audio.paused) {\n                state.audio.pause();\n            }\n        }\n\n        if (this.props.player.audioId !== prevProps.player.audioId) {\n            this.changeAudio(this.props.player.audioId);\n        }\n    }\n\n\n\n    changeAudio = (audioId) => {\n        console.log(audioId);\n        const {audio} = this.state;\n        audio.pause();\n\n        const {player} = this.props;\n        const newAudio = player.audioList.filter(audio => audio.id === audioId);\n\n        this.setState({\n            isLoading: true,\n            audio: new Audio(newAudio[0].url),\n        }, () => {\n\n            const {audio} = this.state;\n            audio.onloadedmetadata = () => {\n                this.setState({\n                    isLoading: false,\n                    duration: audio.duration\n                })\n            };\n            audio.ontimeupdate = () => {\n                this.setState({\n                    currentTime: audio.currentTime\n                });\n                if (audio.currentTime === audio.duration) {\n                    audio.pause();\n                    this.setState({isPlaying: false});\n                }\n            };\n\n            this.playAudio();\n\n        });\n\n    };\n\n\n    playAudio = () => {\n        const {playAudio} = this.props;\n        const {audio} = this.state;\n\n        playAudio();\n        audio.play();\n    };\n\n\n    changeVolume = value => {\n        const {audio} = this.state;\n\n        this.setState({volume: value});\n        audio.volume = value / 100;\n    };\n\n    handleAudioLoop = () => {\n        const {audio, loop} = this.state;\n\n        if (loop) {\n            audio.loop = false;\n            this.setState({loop: false});\n        } else {\n            audio.loop = true;\n            this.setState({loop: true});\n        }\n    };\n\n\n    setAudioDuration = currentTime => {\n        const {audio} = this.state;\n        this.setState({currentTime});\n        audio.currentTime = currentTime;\n    };\n\n    componentDidMount() {\n\n        const {audioList, audioId} = this.props.player;\n        const newAudio = audioList.filter(audio => audio.id === audioId);\n\n        this.setState({\n            audio: new Audio(newAudio[0].url),\n        }, () => {\n\n            const {audio} = this.state;\n            audio.onloadedmetadata = () => {\n                this.setState({\n                    isLoading: false,\n                    duration: audio.duration\n                })\n            };\n            audio.ontimeupdate = () => {\n                this.setState({\n                    currentTime: audio.currentTime\n                });\n                if (audio.currentTime === audio.duration) {\n                    audio.pause();\n                    this.setState({isPlaying: false});\n                }\n            }\n        });\n    }\n\n\n    render() {\n        const {audio, isPlaying, volume, isLoading, duration, currentTime, loop} = this.state;\n        const {togglePlayPanel, showPlayPanel, player} = this.props;\n\n\n\n\n        return (\n            <PlayPanel\n                isLoading={isLoading}\n                currentAudioObj={player.audioList.filter(audio => audio.id === player.audioId)}\n                audio={audio}\n                isPlaying={isPlaying}\n                handlePlay={this.handlePlay}\n                handlePlayNext={this.handlePlayNext}\n                handlePlayPrev={this.handlePlayPrev}\n                defaultVolume={defaultVolume}\n                volume={volume}\n                changeVolume={this.changeVolume}\n                duration={duration}\n                currentTime={currentTime}\n                loop={loop}\n                handleAudioLoop={this.handleAudioLoop}\n                setAudioDuration={this.setAudioDuration}\n\n                togglePlayPanel={togglePlayPanel}\n                showPlayPanel={showPlayPanel}\n\n\n                player={player}\n\n                // audioPlayer={audioPlayer}\n                // handleMetadata={handleMetadata}\n                // handleTimeupdate={handleTimeupdate}\n\n                // currentTrackMoment={currentTrackMoment}\n                // currentTrackDuration={currentTrackDuration}\n                // currentAudio={currentAudio}\n            />\n        );\n    }\n}\n\nPlayPanelContainer.propTypes = {\n    player: PropTypes.object,\n    playNextAudio: PropTypes.func,\n};\n\nexport default connect(state => ({\n    player: state.player,\n    showPlayPanel: state.app.showPlayPanel\n}), {playNextAudio, togglePlayPanel, playAudio})(PlayPanelContainer);"]},"metadata":{},"sourceType":"module"}