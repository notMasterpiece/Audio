{"ast":null,"code":"var audio, audioContext, audioSrc;\nvar analyser, analyserBufferLength;\nvar audioInfo = 'Song: LAKEY INSPIRED - Chill Day'; //---\n\nvar MATHPI2 = Math.PI * 2; //---\n\nvar w;\nvar h;\nvar btStart;\nvar btLoadAudio;\nvar labelLoadAudio;\nvar txtStatus;\nvar canvas;\nvar context;\nvar imageData;\nvar data;\nvar mouseActive = false;\nvar mouseDown = false;\nvar mousePos = {\n  x: 0,\n  y: 0\n};\nvar fov = 250;\nvar speed = 0.75; //0.25;\n\nvar cubeMinHeight = 2;\nvar frequencyDamp = 25;\nvar smoothingTimeConstant = 0.65;\nvar fftSize = 8192; //32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768\n\nvar circleHolder = [];\nvar time = 0;\nvar colorInvertValue = 0;\nvar rgb = {};\nrgb.r = Math.random() * MATHPI2;\nrgb.g = Math.random() * MATHPI2;\nrgb.b = Math.random() * MATHPI2;\nvar rgb2 = {};\nrgb2.r = Math.random() * MATHPI2;\nrgb2.g = Math.random() * MATHPI2;\nrgb2.b = Math.random() * MATHPI2; //---\n\n/*\nfunction getRGBColor() {\n\n  var r = Math.sin( rgb.r += 0.010 ) * 1 + 1;\n  var g = Math.sin( rgb.g += 0.007 ) * 1 + 1;\n  var b = Math.sin( rgb.b += 0.013 ) * 1 + 1;\n  //var r = Math.sin( rgb.r += 0.040 ) * 1 + 1;\n  //var g = Math.sin( rgb.g += 0.028 ) * 1 + 1;\n  //var b = Math.sin( rgb.b += 0.052 ) * 1 + 1;\n\n  return { r:r, g:g, b:b };\n\n};*/\n\nfunction getRGBColor(color) {\n  var r = Math.sin(color.r += 0.010) * 1 + 1;\n  var g = Math.sin(color.g += 0.007) * 1 + 1;\n  var b = Math.sin(color.b += 0.013) * 1 + 1; //var r = Math.sin( color.r += 0.040 ) * 1 + 1;\n  //var g = Math.sin( color.g += 0.028 ) * 1 + 1;\n  //var b = Math.sin( color.b += 0.052 ) * 1 + 1;\n\n  return {\n    r: r,\n    g: g,\n    b: b\n  };\n}\n\n;\n\nfunction getRGBColor2(color) {\n  //var r = Math.sin( color.r += 0.010 ) * 1 + 1;\n  //var g = Math.sin( color.g += 0.007 ) * 1 + 1;\n  //var b = Math.sin( color.b += 0.013 ) * 1 + 1;\n  var r = Math.sin(color.r += 0.040) * 1 + 1;\n  var g = Math.sin(color.g += 0.028) * 1 + 1;\n  var b = Math.sin(color.b += 0.052) * 1 + 1;\n  return {\n    r: r,\n    g: g,\n    b: b\n  };\n}\n\n;\n\nfunction limitRGBColor(color, percent = 0.45) {\n  if (color.r < percent) {\n    color.r = percent;\n  }\n\n  if (color.g < percent) {\n    color.g = percent;\n  }\n\n  if (color.b < percent) {\n    color.b = percent;\n  }\n}\n\n;\nexport const init = () => {\n  canvas = document.createElement('canvas');\n  canvas.classList.add('audio-canvas');\n  canvas.addEventListener('mousedown', mouseDownHandler, false);\n  canvas.addEventListener('mouseup', mouseUpHandler, false);\n  canvas.addEventListener('mousemove', mouseMoveHandler, false);\n  canvas.addEventListener('mouseenter', mouseEnterHandler, false);\n  canvas.addEventListener('mouseleave', mouseLeaveHandler, false);\n  document.body.appendChild(canvas);\n  context = canvas.getContext('2d');\n  window.addEventListener('resize', onResize, false);\n  onResize();\n  addCircles();\n  render();\n  clearImageData();\n  render();\n  context.putImageData(imageData, 0, 0); // btStart = document.getElementById('btStartAudioVisualization');\n  // btStart.addEventListener('mousedown', userStart, false);\n  //\n  // btLoadAudio = document.getElementById('btLoadAudio');\n  // btLoadAudio.addEventListener('change', loadAudioFileHandler, false);\n  //\n  // labelLoadAudio = document.getElementById('labelLoadAudio');\n  // labelLoadAudio.style.display = 'none';\n  //\n  // txtStatus = document.getElementById('txtStatus');\n  // txtStatus.innerHTML = 'Waiting Patiently For You... Please Click the Start Button.';\n}; //---\n\nfunction userStart() {\n  btStart.removeEventListener('mousedown', userStart);\n  btStart.addEventListener('mousedown', audioBtHandler, false);\n  btStart.innerHTML = 'Pause Audio';\n  btStart.style.display = 'none';\n  txtStatus.innerHTML = 'Loading Audio...';\n  audioSetup('http://nkunited.de/ExternalImages/jsfiddle/audio/ChillDay_comp.mp3');\n  animate();\n}\n\n; //---\n\nfunction audioSetup(url) {\n  if (audio) {\n    audio.pause();\n  }\n\n  audio = new Audio();\n  audio.src = url;\n  audio.controls = false;\n  audio.loop = true;\n  audio.autoplay = true;\n  audio.crossOrigin = 'anonymous';\n  audio.addEventListener('canplaythrough', audioLoaded, false);\n  audioContext = new (window.AudioContext || window.webkitAudioContext)();\n  analyser = audioContext.createAnalyser();\n  analyser.connect(audioContext.destination);\n  analyser.smoothingTimeConstant = smoothingTimeConstant;\n  analyser.fftSize = fftSize;\n  analyserBufferLength = analyser.frequencyBinCount;\n  audioSrc = audioContext.createMediaElementSource(audio);\n  audioSrc.connect(analyser);\n}\n\n;\n\nfunction audioLoaded(e) {\n  txtStatus.innerHTML = audioInfo;\n  btStart.style.display = 'inline-block';\n  labelLoadAudio.style.display = 'inline-block';\n}\n\n;\n\nfunction loadAudioFileHandler(e) {\n  loadFile(e);\n}\n\n;\n\nfunction loadFile(e) {\n  var input = e.target;\n  var reader = new FileReader();\n  audioInfo = input.files[0].name;\n  audioSetup(URL.createObjectURL(input.files[0]));\n}\n\n; //---\n\nfunction clearImageData() {\n  for (var i = 0, l = data.length; i < l; i += 4) {\n    data[i] = 0;\n    data[i + 1] = 0;\n    data[i + 2] = 0;\n    data[i + 3] = 255;\n  }\n}\n\n;\n\nfunction setPixel(x, y, r, g, b, a) {\n  var i = (x + y * imageData.width) * 4;\n  data[i] = r;\n  data[i + 1] = g;\n  data[i + 2] = b;\n  data[i + 3] = a;\n}\n\n; //---\n\nfunction drawLine(x1, y1, x2, y2, r, g, b, a) {\n  var dx = Math.abs(x2 - x1);\n  var dy = Math.abs(y2 - y1);\n  var sx = x1 < x2 ? 1 : -1;\n  var sy = y1 < y2 ? 1 : -1;\n  var err = dx - dy;\n  var lx = x1;\n  var ly = y1;\n\n  while (true) {\n    if (lx > 0 && lx < w && ly > 0 && ly < h) {\n      setPixel(lx, ly, r, g, b, a);\n    }\n\n    if (lx === x2 && ly === y2) break;\n    var e2 = 2 * err;\n\n    if (e2 > -dx) {\n      err -= dy;\n      lx += sx;\n    }\n\n    if (e2 < dy) {\n      err += dx;\n      ly += sy;\n    }\n  }\n}\n\n; //---\n\nfunction getCirclePosition(centerX, centerY, radius, index, segments) {\n  var angle = index * (MATHPI2 / segments) + time;\n  var x = centerX + Math.cos(angle) * radius;\n  var y = centerY + Math.sin(angle) * radius;\n  return {\n    x: x,\n    y: y\n  };\n}\n\n;\n\nfunction drawCircle(centerPosition, radius, segments) {\n  var coordinates = [];\n  var radiusSave;\n  var diff = 0; //Math.floor( Math.random() * segments );\n\n  for (var i = 0; i <= segments; i++) {\n    //var radiusRandom = radius + Math.random() * ( radius / 8 );\n    //var radiusRandom = radius + Math.random() * ( radius / 32 );\n    var radiusRandom = radius; // + ( radius / 8 );\n\n    if (i === 0) {\n      radiusSave = radiusRandom;\n    }\n\n    if (i === segments) {\n      radiusRandom = radiusSave;\n    }\n\n    var centerX = centerPosition.x;\n    var centerY = centerPosition.y;\n    var position = getCirclePosition(centerX, centerY, radiusRandom, i, segments);\n    coordinates.push({\n      x: position.x,\n      y: position.y,\n      index: i + diff,\n      radius: radiusRandom,\n      segments: segments\n    });\n  }\n\n  return coordinates;\n}\n\n;\n\nfunction addCircleSegment(x, y, z, audioBufferIndex) {\n  var circleSegment = {};\n  circleSegment.x = x;\n  circleSegment.y = y; //circleSegment.z = z;\n\n  circleSegment.x2d = 0;\n  circleSegment.y2d = 0;\n  circleSegment.audioBufferIndex = audioBufferIndex;\n  return circleSegment;\n}\n\n;\n\nfunction addCircles() {\n  var audioBufferIndexMin = 8;\n  var audioBufferIndexMax = 1024;\n  var audioBufferIndex = audioBufferIndexMin;\n  var centerPosition = {\n    x: 0,\n    y: 0\n  };\n  var center = {\n    x: 0,\n    y: 0\n  };\n  var toggle = 1;\n  var index = 0;\n  var audioIndex = audioBufferIndexMin;\n  var mp = {\n    x: Math.random() * w,\n    y: Math.random() * h\n  };\n\n  for (var z = -fov; z < fov; z += 5) {\n    var coordinates = drawCircle(centerPosition, 75, 64);\n    var circleObj = {};\n    circleObj.segmentsOutside = [];\n    circleObj.segmentsInside = [];\n    circleObj.segmentsInside2 = [];\n    circleObj.segmentsCount = 0;\n    circleObj.index = index; //circleObj.audioIndex = audioIndex;\n\n    circleObj.z = z;\n    circleObj.center = center;\n    circleObj.circleCenter = {\n      x: 0,\n      y: 0\n    };\n    circleObj.mp = {\n      x: mp.x,\n      y: mp.y\n    };\n    circleObj.radius = coordinates[0].radius; //circleObj.radiusAudio = circleObj.radius;\n\n    circleObj.color = {\n      r: 0,\n      g: 0,\n      b: 0\n    }; //toggle = index % 4;\n\n    toggle = index % 2;\n    index++;\n\n    if (z < 0) {\n      audioIndex++;\n    } else {\n      audioIndex--;\n    }\n\n    audioBufferIndex = Math.floor(Math.random() * audioBufferIndexMax) + audioBufferIndexMin; //audioBufferIndex = audioBufferIndexMin;\n\n    var circleSegmentOutside;\n\n    for (var i = 0, l = coordinates.length; i < l; i++) {\n      var coordinate = coordinates[i]; //if ( i % 4 === toggle && i % 2 === 1 ) {\n\n      if (i % 2 === toggle) {\n        circleSegmentOutside = addCircleSegment(coordinate.x, coordinate.y, z, audioBufferIndex);\n        circleSegmentOutside.active = true;\n        circleSegmentOutside.index = coordinate.index;\n        circleSegmentOutside.radius = coordinate.radius;\n        circleSegmentOutside.radiusAudio = circleSegmentOutside.radius; // + Math.random() * 15;\n\n        circleSegmentOutside.segments = coordinate.segments;\n        circleSegmentOutside.coordinates = [];\n        var co;\n\n        if (i > 0) {\n          co = coordinates[i - 1];\n        } else {\n          co = coordinates[l - 1];\n        }\n\n        var sub1 = addCircleSegment(co.x, co.y, z, audioBufferIndex);\n        var sub2 = addCircleSegment(coordinate.x, coordinate.y, z - 5, audioBufferIndex);\n        var sub3 = addCircleSegment(co.x, co.y, z - 5, audioBufferIndex);\n        var sub4 = addCircleSegment(coordinate.x, coordinate.y, z, audioBufferIndex);\n        var sub5 = addCircleSegment(co.x, co.y, z, audioBufferIndex);\n        var sub6 = addCircleSegment(coordinate.x, coordinate.y, z - 5, audioBufferIndex);\n        var sub7 = addCircleSegment(co.x, co.y, z - 5, audioBufferIndex);\n        sub1.index = co.index;\n        sub2.index = coordinate.index;\n        sub3.index = co.index;\n        sub4.index = coordinate.index;\n        sub5.index = co.index;\n        sub6.index = coordinate.index;\n        sub7.index = co.index;\n        circleSegmentOutside.subs = [];\n        circleSegmentOutside.subs.push(sub1, sub2, sub3, sub4, sub5, sub6, sub7); //audioBufferIndex = Math.floor( Math.random() * audioBufferIndexMax ) + audioBufferIndexMin;\n\n        if (i < l - 1) {\n          audioBufferIndex = Math.floor(Math.random() * audioBufferIndexMax) + audioBufferIndexMin;\n        } else {\n          audioBufferIndex = circleObj.segmentsOutside[0].audioBufferIndex;\n        }\n\n        circleObj.segmentsOutside.push(circleSegmentOutside);\n      } else {\n        circleObj.segmentsOutside.push({\n          active: false\n        });\n      }\n    }\n\n    circleHolder.push(circleObj);\n  }\n}\n\n;\n\nfunction onResize() {\n  w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n  h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n  canvas.width = w;\n  canvas.height = h;\n  context.fillStyle = '#000000';\n  context.fillRect(0, 0, w, h);\n  imageData = context.getImageData(0, 0, w, h);\n  data = imageData.data;\n}\n\n;\n\nfunction audioBtHandler(event) {\n  if (audio.paused) {\n    audio.play();\n    btStart.innerHTML = 'Pause Audio';\n  } else {\n    audio.pause();\n    btStart.innerHTML = 'Play Audio';\n  }\n}\n\n; //---\n\nfunction mouseDownHandler(event) {\n  mouseDown = true;\n}\n\n;\n\nfunction mouseUpHandler(event) {\n  mouseDown = false;\n}\n\n;\n\nfunction mouseEnterHandler(event) {\n  mouseActive = true;\n}\n\n;\n\nfunction mouseLeaveHandler(event) {\n  mouseActive = false; //mousePos.x = w / 2;\n  //mousePos.y = h / 2;\n\n  mouseDown = false;\n}\n\n;\n\nfunction mouseMoveHandler(event) {\n  mousePos = getMousePos(canvas, event);\n}\n\n;\n\nfunction getMousePos(canvas, event) {\n  var rect = canvas.getBoundingClientRect();\n  return {\n    x: event.clientX - rect.left,\n    y: event.clientY - rect.top\n  };\n}\n\n; //---\n\nfunction render() {\n  var aa = false;\n\n  if (analyser) {\n    aa = true;\n  }\n\n  var frequencySource;\n\n  if (aa === true) {\n    frequencySource = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(frequencySource);\n  } //---\n\n\n  var sortArray = false; //---\n\n  var col = getRGBColor2(rgb);\n  var col2 = getRGBColor(rgb2);\n  limitRGBColor(col, 0.45);\n  limitRGBColor(col2, 0.25); //---\n\n  for (var i = 0, l = circleHolder.length; i < l; i++) {\n    var circleObj = circleHolder[i];\n    circleObj.color.r = col.r - (circleObj.z + fov) / fov;\n    circleObj.color.g = col.g - (circleObj.z + fov) / fov;\n    circleObj.color.b = col.b - (circleObj.z + fov) / fov; //circleObj.color.r = Math.floor( ( ( ( col.r - circleObj.z + fov ) ) + ( col2.r - circleObj.z + fov ) ) / 2 );\n    //circleObj.color.g = Math.floor( ( ( ( col.g - circleObj.z + fov ) ) + ( col2.g - circleObj.z + fov ) ) / 2 );\n    //circleObj.color.b = Math.floor( ( ( ( col.b - circleObj.z + fov ) ) + ( col2.b - circleObj.z + fov ) ) / 2 );\n\n    if (circleObj.color.r < col2.r) {\n      circleObj.color.r = col2.r;\n    }\n\n    if (circleObj.color.g < col2.g) {\n      circleObj.color.g = col2.g;\n    }\n\n    if (circleObj.color.b < col2.b) {\n      circleObj.color.b = col2.b;\n    }\n\n    var circleObjBack;\n\n    if (i > 0) {\n      circleObjBack = circleHolder[i - 1];\n    } //---\n\n\n    if (mouseActive) {\n      circleObj.mp = mousePos;\n    } else {\n      circleObj.mp.x += (w / 2 - circleObj.mp.x) * 0.00025;\n      circleObj.mp.y += (h / 2 - circleObj.mp.y) * 0.00025;\n    } //circleObj.center.x = ( ( w / 2 ) - circleObj.mp.x ) * ( -i / 150 ) + w / 2;\n    //circleObj.center.y = ( ( h / 2 ) - circleObj.mp.y ) * ( -i / 150 ) + h / 2;\n\n\n    circleObj.center.x = (w / 2 - circleObj.mp.x) * ((circleObj.z - fov) / 500) + w / 2;\n    circleObj.center.y = (h / 2 - circleObj.mp.y) * ((circleObj.z - fov) / 500) + h / 2; //---\n\n    if (aa === true) {} //var f = frequencySource[ Math.floor(circleObj.z + fov) ];\n    //var f = frequencySource[ i ];\n    //var f = frequencySource[ circleObj.audioIndex ];\n    //var fAdd = (f / 25);// * ( (circleObj.z - fov) / 200 );\n    //circleObj.radiusAudio = fAdd;\n    //---\n\n\n    for (var j = 0, k = circleObj.segmentsOutside.length; j < k; j++) {\n      var circleSegmentOutside = circleObj.segmentsOutside[j];\n\n      if (circleSegmentOutside.active === true) {\n        //---\n        var scale = fov / (fov + circleObj.z);\n        var scaleBack;\n\n        if (i > 0) {\n          scaleBack = fov / (fov + circleObjBack.z);\n        }\n\n        var frequency, frequencyAdd;\n        circleSegmentOutside.x2d = circleSegmentOutside.x * scale + circleObj.center.x;\n        circleSegmentOutside.y2d = circleSegmentOutside.y * scale + circleObj.center.y; //---\n\n        if (aa === true) {\n          frequency = frequencySource[circleSegmentOutside.audioBufferIndex];\n          frequencyAdd = frequency / 20; //---\n\n          circleSegmentOutside.radiusAudio = circleSegmentOutside.radius - frequencyAdd;\n        } //---\n\n\n        var lineColorValue = 0;\n\n        if (j > 0) {\n          if (aa === true && audio.paused === false) {\n            lineColorValue = Math.round(i / l * (55 + frequency)); //255\n\n            if (lineColorValue > 255) {\n              lineColorValue = 255;\n            }\n          } else {\n            lineColorValue = Math.round(i / l * 200); //255\n          }\n        } //---\n\n\n        if (i > 0 && i < l - 1) {\n          var sub1 = circleSegmentOutside.subs[0];\n          var sub1angle = sub1.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub1.x2d = sub1.x * scale + circleObj.center.x;\n          sub1.y2d = sub1.y * scale + circleObj.center.y;\n          sub1.x = circleObj.circleCenter.x + Math.cos(sub1angle) * circleSegmentOutside.radiusAudio;\n          sub1.y = circleObj.circleCenter.y + Math.sin(sub1angle) * circleSegmentOutside.radiusAudio;\n          var sub2 = circleSegmentOutside.subs[1];\n          var sub2angle = sub2.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub2.x2d = sub2.x * scaleBack + circleObjBack.center.x;\n          sub2.y2d = sub2.y * scaleBack + circleObjBack.center.y;\n          sub2.x = circleObj.circleCenter.x + Math.cos(sub2angle) * circleSegmentOutside.radiusAudio;\n          sub2.y = circleObj.circleCenter.y + Math.sin(sub2angle) * circleSegmentOutside.radiusAudio;\n          var sub3 = circleSegmentOutside.subs[2];\n          var sub3angle = sub3.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub3.x2d = sub3.x * scaleBack + circleObjBack.center.x;\n          sub3.y2d = sub3.y * scaleBack + circleObjBack.center.y;\n          sub3.x = circleObj.circleCenter.x + Math.cos(sub3angle) * circleSegmentOutside.radiusAudio;\n          sub3.y = circleObj.circleCenter.y + Math.sin(sub3angle) * circleSegmentOutside.radiusAudio;\n          var sub4 = circleSegmentOutside.subs[3];\n          var sub4angle = sub4.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub4.x2d = sub4.x * scale + circleObj.center.x;\n          sub4.y2d = sub4.y * scale + circleObj.center.y;\n          sub4.x = circleObj.circleCenter.x + Math.cos(sub4angle) * circleSegmentOutside.radius;\n          sub4.y = circleObj.circleCenter.y + Math.sin(sub4angle) * circleSegmentOutside.radius;\n          var sub5 = circleSegmentOutside.subs[4];\n          var sub5angle = sub5.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub5.x2d = sub5.x * scale + circleObj.center.x;\n          sub5.y2d = sub5.y * scale + circleObj.center.y;\n          sub5.x = circleObj.circleCenter.x + Math.cos(sub5angle) * circleSegmentOutside.radius;\n          sub5.y = circleObj.circleCenter.y + Math.sin(sub5angle) * circleSegmentOutside.radius;\n          var sub6 = circleSegmentOutside.subs[5];\n          var sub6angle = sub6.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub6.x2d = sub6.x * scaleBack + circleObjBack.center.x;\n          sub6.y2d = sub6.y * scaleBack + circleObjBack.center.y;\n          sub6.x = circleObj.circleCenter.x + Math.cos(sub6angle) * circleSegmentOutside.radius;\n          sub6.y = circleObj.circleCenter.y + Math.sin(sub6angle) * circleSegmentOutside.radius;\n          var sub7 = circleSegmentOutside.subs[6];\n          var sub7angle = sub7.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n          sub7.x2d = sub7.x * scaleBack + circleObjBack.center.x;\n          sub7.y2d = sub7.y * scaleBack + circleObjBack.center.y;\n          sub7.x = circleObj.circleCenter.x + Math.cos(sub7angle) * circleSegmentOutside.radius;\n          sub7.y = circleObj.circleCenter.y + Math.sin(sub7angle) * circleSegmentOutside.radius;\n          var p1;\n          var p2;\n          var p3;\n          var p4;\n          var p5 = circleSegmentOutside.subs[3];\n          var p6 = circleSegmentOutside.subs[4];\n          var p7 = circleSegmentOutside.subs[6];\n          var p8 = circleSegmentOutside.subs[5];\n\n          if (frequencyAdd > 0) {\n            p1 = circleSegmentOutside;\n            p2 = circleSegmentOutside.subs[1];\n            p3 = circleSegmentOutside.subs[2];\n            p4 = circleSegmentOutside.subs[0];\n          }\n\n          var cr = Math.round(circleObj.color.r * lineColorValue);\n          var cg = Math.round(circleObj.color.g * lineColorValue);\n          var cb = Math.round(circleObj.color.b * lineColorValue);\n\n          if (frequencyAdd > 0) {\n            drawLine(p1.x2d | 0, p1.y2d | 0, p2.x2d | 0, p2.y2d | 0, cr, cg, cb, 255);\n            drawLine(p2.x2d | 0, p2.y2d | 0, p3.x2d | 0, p3.y2d | 0, cr, cg, cb, 255);\n            drawLine(p3.x2d | 0, p3.y2d | 0, p4.x2d | 0, p4.y2d | 0, cr, cg, cb, 255);\n            drawLine(p4.x2d | 0, p4.y2d | 0, p1.x2d | 0, p1.y2d | 0, cr, cg, cb, 255);\n            drawLine(p5.x2d | 0, p5.y2d | 0, p1.x2d | 0, p1.y2d | 0, cr, cg, cb, 255);\n            drawLine(p6.x2d | 0, p6.y2d | 0, p4.x2d | 0, p4.y2d | 0, cr, cg, cb, 255);\n            drawLine(p7.x2d | 0, p7.y2d | 0, p3.x2d | 0, p3.y2d | 0, cr, cg, cb, 255);\n            drawLine(p8.x2d | 0, p8.y2d | 0, p2.x2d | 0, p2.y2d | 0, cr, cg, cb, 255);\n          }\n\n          if (circleObj.z < fov / 2) {\n            drawLine(p5.x2d | 0, p5.y2d | 0, p6.x2d | 0, p6.y2d | 0, cr, cg, cb, 255);\n            drawLine(p6.x2d | 0, p6.y2d | 0, p7.x2d | 0, p7.y2d | 0, cr, cg, cb, 255);\n            drawLine(p7.x2d | 0, p7.y2d | 0, p8.x2d | 0, p8.y2d | 0, cr, cg, cb, 255);\n            drawLine(p8.x2d | 0, p8.y2d | 0, p5.x2d | 0, p5.y2d | 0, cr, cg, cb, 255);\n          }\n        } //---\n\n\n        var circleSegmentOutsideangle; //if ( j < k - 1 ) {\n\n        circleSegmentOutsideangle = circleSegmentOutside.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n        circleSegmentOutside.x = circleObj.circleCenter.x + Math.cos(circleSegmentOutsideangle) * circleSegmentOutside.radiusAudio;\n        circleSegmentOutside.y = circleObj.circleCenter.y + Math.sin(circleSegmentOutsideangle) * circleSegmentOutside.radiusAudio;\n        /*} else {\n           var circleSegmentOutside1 = circleObj.segmentsOutside[ 0 ];\n           circleSegmentOutsideangle = circleSegmentOutside1.index * ( MATHPI2 / circleSegmentOutside1.segments ) + time;\n           circleSegmentOutside.x = circleObj.circleCenter.x + Math.cos( circleSegmentOutsideangle ) * circleSegmentOutside1.radiusAudio;\n          circleSegmentOutside.y = circleObj.circleCenter.y + Math.sin( circleSegmentOutsideangle ) * circleSegmentOutside1.radiusAudio;\n            }\n        */\n        //---\n\n        /*\n        if ( i > 0 && i < l - 1 ) {\n        //if ( i > 0 && i < l - 1 && j < k - 1 ) {\n         var circleSegmentOutsideLineBack;// = circleObjBack[ j ];\n        var circleSegmentInsideLineBack;\n         //if ( j === 0 ) {\n           //pB = circleObjBack.segments[ circleObjBack.segments.length - 1 ];\n         //} else {\n           //pB = circleObjBack.segments[ j - 1 ];\n         //}\n         circleSegmentOutsideLineBack = circleObjBack.segmentsOutside[ j ];\n        circleSegmentInsideLineBack = circleObjBack.segmentsInside[ j ];\n         //drawLine( circleSegmentOutside.x2d | 0, circleSegmentOutside.y2d | 0, circleSegmentOutsideLineBack.x2d | 0, circleSegmentOutsideLineBack.y2d | 0, 0, Math.round( lineColorValue / 2 ), lineColorValue, 255 );\n        //drawLine( circleSegmentInside.x2d | 0, circleSegmentInside.y2d | 0, circleSegmentInsideLineBack.x2d | 0, circleSegmentInsideLineBack.y2d | 0, 0, Math.round( lineColorValue / 2 ), lineColorValue, 255 );\n        }\n        */\n      }\n    }\n\n    if (mouseDown) {\n      circleObj.z += speed;\n\n      if (circleObj.z > fov) {\n        circleObj.z -= fov * 2;\n        sortArray = true;\n      }\n    } else {\n      circleObj.z -= speed;\n\n      if (circleObj.z < -fov) {\n        circleObj.z += fov * 2;\n        sortArray = true;\n      }\n    }\n  } //---\n\n\n  if (sortArray) {\n    circleHolder = circleHolder.sort(function (a, b) {\n      return b.z - a.z;\n    });\n  } //---\n\n\n  if (mouseDown) {\n    time -= 0.005;\n  } else {\n    time += 0.005;\n  } //---\n  //soft invert colors\n\n\n  if (mouseDown) {\n    if (colorInvertValue < 255) colorInvertValue += 5;else colorInvertValue = 255;\n    softInvert(colorInvertValue);\n  } else {\n    if (colorInvertValue > 0) colorInvertValue -= 5;else colorInvertValue = 0;\n    if (colorInvertValue > 0) softInvert(colorInvertValue);\n  }\n}\n\n; //---\n\nfunction softInvert(value) {\n  for (var j = 0, n = data.length; j < n; j += 4) {\n    data[j] = Math.abs(value - data[j]); // red\n\n    data[j + 1] = Math.abs(value - data[j + 1]); // green\n\n    data[j + 2] = Math.abs(value - data[j + 2]); // blue\n\n    data[j + 3] = 255; // - data[ j + 3 ]; // alpha\n  }\n}\n\n; //---\n\nfunction animate() {\n  clearImageData();\n  render();\n  context.putImageData(imageData, 0, 0);\n  requestAnimationFrame(animate);\n}\n\n;\n\nwindow.requestAnimFrame = function () {\n  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (callback) {\n    window.setTimeout(callback, 1000 / 60);\n  };\n}();","map":{"version":3,"sources":["/Grawdanin/MERN/audio/src/components/AudioVizyalization/animation.js"],"names":["audio","audioContext","audioSrc","analyser","analyserBufferLength","audioInfo","MATHPI2","Math","PI","w","h","btStart","btLoadAudio","labelLoadAudio","txtStatus","canvas","context","imageData","data","mouseActive","mouseDown","mousePos","x","y","fov","speed","cubeMinHeight","frequencyDamp","smoothingTimeConstant","fftSize","circleHolder","time","colorInvertValue","rgb","r","random","g","b","rgb2","getRGBColor","color","sin","getRGBColor2","limitRGBColor","percent","init","document","createElement","classList","add","addEventListener","mouseDownHandler","mouseUpHandler","mouseMoveHandler","mouseEnterHandler","mouseLeaveHandler","body","appendChild","getContext","window","onResize","addCircles","render","clearImageData","putImageData","userStart","removeEventListener","audioBtHandler","innerHTML","style","display","audioSetup","animate","url","pause","Audio","src","controls","loop","autoplay","crossOrigin","audioLoaded","AudioContext","webkitAudioContext","createAnalyser","connect","destination","frequencyBinCount","createMediaElementSource","e","loadAudioFileHandler","loadFile","input","target","reader","FileReader","files","name","URL","createObjectURL","i","l","length","setPixel","a","width","drawLine","x1","y1","x2","y2","dx","abs","dy","sx","sy","err","lx","ly","e2","getCirclePosition","centerX","centerY","radius","index","segments","angle","cos","drawCircle","centerPosition","coordinates","radiusSave","diff","radiusRandom","position","push","addCircleSegment","z","audioBufferIndex","circleSegment","x2d","y2d","audioBufferIndexMin","audioBufferIndexMax","center","toggle","audioIndex","mp","circleObj","segmentsOutside","segmentsInside","segmentsInside2","segmentsCount","circleCenter","floor","circleSegmentOutside","coordinate","active","radiusAudio","co","sub1","sub2","sub3","sub4","sub5","sub6","sub7","subs","innerWidth","documentElement","clientWidth","innerHeight","clientHeight","height","fillStyle","fillRect","getImageData","event","paused","play","getMousePos","rect","getBoundingClientRect","clientX","left","clientY","top","aa","frequencySource","Uint8Array","getByteFrequencyData","sortArray","col","col2","circleObjBack","j","k","scale","scaleBack","frequency","frequencyAdd","lineColorValue","round","sub1angle","sub2angle","sub3angle","sub4angle","sub5angle","sub6angle","sub7angle","p1","p2","p3","p4","p5","p6","p7","p8","cr","cg","cb","circleSegmentOutsideangle","sort","softInvert","value","n","requestAnimationFrame","requestAnimFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setTimeout"],"mappings":"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","sourcesContent":["var audio, audioContext, audioSrc;\nvar analyser, analyserBufferLength;\nvar audioInfo = 'Song: LAKEY INSPIRED - Chill Day';\n\n//---\n\nvar MATHPI2 = Math.PI * 2;\n\n//---\n\nvar w;\nvar h;\n\nvar btStart;\nvar btLoadAudio;\nvar labelLoadAudio;\nvar txtStatus;\nvar canvas;\nvar context;\n\nvar imageData;\nvar data;\n\nvar mouseActive = false;\nvar mouseDown = false;\nvar mousePos = {x: 0, y: 0};\n\nvar fov = 250;\n\nvar speed = 0.75;//0.25;\n\nvar cubeMinHeight = 2;\n\nvar frequencyDamp = 25;\nvar smoothingTimeConstant = 0.65;\nvar fftSize = 8192;//32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768\n\nvar circleHolder = [];\n\nvar time = 0;\n\nvar colorInvertValue = 0;\n\nvar rgb = {};\nrgb.r = Math.random() * MATHPI2;\nrgb.g = Math.random() * MATHPI2;\nrgb.b = Math.random() * MATHPI2;\n\nvar rgb2 = {};\nrgb2.r = Math.random() * MATHPI2;\nrgb2.g = Math.random() * MATHPI2;\nrgb2.b = Math.random() * MATHPI2;\n\n//---\n/*\nfunction getRGBColor() {\n\n  var r = Math.sin( rgb.r += 0.010 ) * 1 + 1;\n  var g = Math.sin( rgb.g += 0.007 ) * 1 + 1;\n  var b = Math.sin( rgb.b += 0.013 ) * 1 + 1;\n  //var r = Math.sin( rgb.r += 0.040 ) * 1 + 1;\n  //var g = Math.sin( rgb.g += 0.028 ) * 1 + 1;\n  //var b = Math.sin( rgb.b += 0.052 ) * 1 + 1;\n\n  return { r:r, g:g, b:b };\n\n};*/\n\nfunction getRGBColor(color) {\n\n    var r = Math.sin(color.r += 0.010) * 1 + 1;\n    var g = Math.sin(color.g += 0.007) * 1 + 1;\n    var b = Math.sin(color.b += 0.013) * 1 + 1;\n    //var r = Math.sin( color.r += 0.040 ) * 1 + 1;\n    //var g = Math.sin( color.g += 0.028 ) * 1 + 1;\n    //var b = Math.sin( color.b += 0.052 ) * 1 + 1;\n\n    return {r: r, g: g, b: b};\n\n};\n\nfunction getRGBColor2(color) {\n\n    //var r = Math.sin( color.r += 0.010 ) * 1 + 1;\n    //var g = Math.sin( color.g += 0.007 ) * 1 + 1;\n    //var b = Math.sin( color.b += 0.013 ) * 1 + 1;\n    var r = Math.sin(color.r += 0.040) * 1 + 1;\n    var g = Math.sin(color.g += 0.028) * 1 + 1;\n    var b = Math.sin(color.b += 0.052) * 1 + 1;\n\n    return {r: r, g: g, b: b};\n\n};\n\nfunction limitRGBColor(color, percent = 0.45) {\n\n    if (color.r < percent) {\n\n        color.r = percent;\n\n    }\n\n    if (color.g < percent) {\n\n        color.g = percent;\n\n    }\n\n    if (color.b < percent) {\n\n        color.b = percent;\n\n    }\n\n};\n\nexport const init = () => {\n    canvas = document.createElement('canvas');\n    canvas.classList.add('audio-canvas');\n    canvas.addEventListener('mousedown', mouseDownHandler, false);\n    canvas.addEventListener('mouseup', mouseUpHandler, false);\n    canvas.addEventListener('mousemove', mouseMoveHandler, false);\n    canvas.addEventListener('mouseenter', mouseEnterHandler, false);\n    canvas.addEventListener('mouseleave', mouseLeaveHandler, false);\n\n    document.body.appendChild(canvas);\n\n    context = canvas.getContext('2d');\n\n    window.addEventListener('resize', onResize, false);\n\n    onResize();\n\n    addCircles();\n\n    render();\n\n    clearImageData();\n\n    render();\n\n    context.putImageData(imageData, 0, 0);\n\n    // btStart = document.getElementById('btStartAudioVisualization');\n    // btStart.addEventListener('mousedown', userStart, false);\n    //\n    // btLoadAudio = document.getElementById('btLoadAudio');\n    // btLoadAudio.addEventListener('change', loadAudioFileHandler, false);\n    //\n    // labelLoadAudio = document.getElementById('labelLoadAudio');\n    // labelLoadAudio.style.display = 'none';\n    //\n    // txtStatus = document.getElementById('txtStatus');\n    // txtStatus.innerHTML = 'Waiting Patiently For You... Please Click the Start Button.';\n\n};\n\n//---\n\nfunction userStart() {\n\n    btStart.removeEventListener('mousedown', userStart);\n\n    btStart.addEventListener('mousedown', audioBtHandler, false);\n    btStart.innerHTML = 'Pause Audio';\n    btStart.style.display = 'none';\n\n    txtStatus.innerHTML = 'Loading Audio...';\n\n    audioSetup('http://nkunited.de/ExternalImages/jsfiddle/audio/ChillDay_comp.mp3');\n    animate();\n\n};\n\n//---\n\nfunction audioSetup(url) {\n\n    if (audio) {\n\n        audio.pause();\n\n    }\n\n    audio = new Audio();\n    audio.src = url;\n    audio.controls = false;\n    audio.loop = true;\n    audio.autoplay = true;\n    audio.crossOrigin = 'anonymous';\n    audio.addEventListener('canplaythrough', audioLoaded, false);\n\n    audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\n    analyser = audioContext.createAnalyser();\n    analyser.connect(audioContext.destination);\n    analyser.smoothingTimeConstant = smoothingTimeConstant;\n    analyser.fftSize = fftSize;\n    analyserBufferLength = analyser.frequencyBinCount;\n\n    audioSrc = audioContext.createMediaElementSource(audio);\n    audioSrc.connect(analyser);\n\n};\n\nfunction audioLoaded(e) {\n\n    txtStatus.innerHTML = audioInfo;\n\n    btStart.style.display = 'inline-block';\n\n    labelLoadAudio.style.display = 'inline-block';\n\n};\n\nfunction loadAudioFileHandler(e) {\n\n    loadFile(e);\n\n};\n\nfunction loadFile(e) {\n\n    var input = e.target;\n    var reader = new FileReader();\n\n    audioInfo = input.files[0].name;\n    audioSetup(URL.createObjectURL(input.files[0]));\n\n};\n\n//---\n\nfunction clearImageData() {\n\n    for (var i = 0, l = data.length; i < l; i += 4) {\n\n        data[i] = 0;\n        data[i + 1] = 0;\n        data[i + 2] = 0;\n        data[i + 3] = 255;\n\n    }\n\n};\n\nfunction setPixel(x, y, r, g, b, a) {\n\n    var i = (x + y * imageData.width) * 4;\n\n    data[i] = r;\n    data[i + 1] = g;\n    data[i + 2] = b;\n    data[i + 3] = a;\n\n};\n\n//---\n\nfunction drawLine(x1, y1, x2, y2, r, g, b, a) {\n\n    var dx = Math.abs(x2 - x1);\n    var dy = Math.abs(y2 - y1);\n\n    var sx = (x1 < x2) ? 1 : -1;\n    var sy = (y1 < y2) ? 1 : -1;\n\n    var err = dx - dy;\n\n    var lx = x1;\n    var ly = y1;\n\n    while (true) {\n\n        if (lx > 0 && lx < w && ly > 0 && ly < h) {\n\n            setPixel(lx, ly, r, g, b, a);\n\n        }\n\n        if ((lx === x2) && (ly === y2))\n            break;\n\n        var e2 = 2 * err;\n\n        if (e2 > -dx) {\n\n            err -= dy;\n            lx += sx;\n\n        }\n\n        if (e2 < dy) {\n\n            err += dx;\n            ly += sy;\n\n        }\n\n    }\n\n};\n\n//---\n\nfunction getCirclePosition(centerX, centerY, radius, index, segments) {\n\n    var angle = index * (MATHPI2 / segments) + time;\n\n    var x = centerX + Math.cos(angle) * radius;\n    var y = centerY + Math.sin(angle) * radius;\n\n    return {x: x, y: y};\n\n};\n\nfunction drawCircle(centerPosition, radius, segments) {\n\n    var coordinates = [];\n\n    var radiusSave;\n\n    var diff = 0;//Math.floor( Math.random() * segments );\n\n    for (var i = 0; i <= segments; i++) {\n\n        //var radiusRandom = radius + Math.random() * ( radius / 8 );\n        //var radiusRandom = radius + Math.random() * ( radius / 32 );\n        var radiusRandom = radius;// + ( radius / 8 );\n\n        if (i === 0) {\n\n            radiusSave = radiusRandom;\n\n        }\n\n        if (i === segments) {\n\n            radiusRandom = radiusSave;\n\n        }\n\n        var centerX = centerPosition.x;\n        var centerY = centerPosition.y;\n\n        var position = getCirclePosition(centerX, centerY, radiusRandom, i, segments);\n\n        coordinates.push({x: position.x, y: position.y, index: i + diff, radius: radiusRandom, segments: segments});\n\n    }\n\n    return coordinates;\n\n};\n\nfunction addCircleSegment(x, y, z, audioBufferIndex) {\n\n    var circleSegment = {};\n    circleSegment.x = x;\n    circleSegment.y = y;\n    //circleSegment.z = z;\n    circleSegment.x2d = 0;\n    circleSegment.y2d = 0;\n    circleSegment.audioBufferIndex = audioBufferIndex;\n\n    return circleSegment;\n\n};\n\nfunction addCircles() {\n\n    var audioBufferIndexMin = 8;\n    var audioBufferIndexMax = 1024;\n    var audioBufferIndex = audioBufferIndexMin;\n\n    var centerPosition = {x: 0, y: 0};\n    var center = {x: 0, y: 0};\n\n    var toggle = 1;\n    var index = 0;\n    var audioIndex = audioBufferIndexMin;\n\n    var mp = {x: Math.random() * w, y: Math.random() * h};\n\n    for (var z = -fov; z < fov; z += 5) {\n\n        var coordinates = drawCircle(centerPosition, 75, 64);\n\n        var circleObj = {};\n        circleObj.segmentsOutside = [];\n        circleObj.segmentsInside = [];\n        circleObj.segmentsInside2 = [];\n        circleObj.segmentsCount = 0;\n        circleObj.index = index;\n        //circleObj.audioIndex = audioIndex;\n        circleObj.z = z;\n        circleObj.center = center;\n        circleObj.circleCenter = {x: 0, y: 0};\n        circleObj.mp = {x: mp.x, y: mp.y};\n        circleObj.radius = coordinates[0].radius;\n        //circleObj.radiusAudio = circleObj.radius;\n        circleObj.color = {r: 0, g: 0, b: 0};\n\n        //toggle = index % 4;\n        toggle = index % 2;\n        index++;\n\n        if (z < 0) {\n\n            audioIndex++;\n\n        } else {\n\n            audioIndex--;\n\n        }\n\n        audioBufferIndex = Math.floor(Math.random() * audioBufferIndexMax) + audioBufferIndexMin;\n        //audioBufferIndex = audioBufferIndexMin;\n\n        var circleSegmentOutside;\n\n        for (var i = 0, l = coordinates.length; i < l; i++) {\n\n            var coordinate = coordinates[i];\n\n            //if ( i % 4 === toggle && i % 2 === 1 ) {\n            if (i % 2 === toggle) {\n\n                circleSegmentOutside = addCircleSegment(coordinate.x, coordinate.y, z, audioBufferIndex);\n                circleSegmentOutside.active = true;\n                circleSegmentOutside.index = coordinate.index;\n                circleSegmentOutside.radius = coordinate.radius;\n                circleSegmentOutside.radiusAudio = circleSegmentOutside.radius;// + Math.random() * 15;\n                circleSegmentOutside.segments = coordinate.segments;\n                circleSegmentOutside.coordinates = [];\n\n                var co;\n\n                if (i > 0) {\n\n                    co = coordinates[i - 1];\n\n                } else {\n\n                    co = coordinates[l - 1];\n\n                }\n\n                var sub1 = addCircleSegment(co.x, co.y, z, audioBufferIndex);\n                var sub2 = addCircleSegment(coordinate.x, coordinate.y, z - 5, audioBufferIndex);\n                var sub3 = addCircleSegment(co.x, co.y, z - 5, audioBufferIndex);\n\n                var sub4 = addCircleSegment(coordinate.x, coordinate.y, z, audioBufferIndex);\n                var sub5 = addCircleSegment(co.x, co.y, z, audioBufferIndex);\n                var sub6 = addCircleSegment(coordinate.x, coordinate.y, z - 5, audioBufferIndex);\n                var sub7 = addCircleSegment(co.x, co.y, z - 5, audioBufferIndex);\n\n                sub1.index = co.index;\n                sub2.index = coordinate.index;\n                sub3.index = co.index;\n\n                sub4.index = coordinate.index;\n                sub5.index = co.index;\n                sub6.index = coordinate.index;\n                sub7.index = co.index;\n\n                circleSegmentOutside.subs = [];\n                circleSegmentOutside.subs.push(sub1, sub2, sub3, sub4, sub5, sub6, sub7);\n\n                //audioBufferIndex = Math.floor( Math.random() * audioBufferIndexMax ) + audioBufferIndexMin;\n\n                if (i < l - 1) {\n\n                    audioBufferIndex = Math.floor(Math.random() * audioBufferIndexMax) + audioBufferIndexMin;\n\n                } else {\n\n                    audioBufferIndex = circleObj.segmentsOutside[0].audioBufferIndex;\n\n                }\n\n                circleObj.segmentsOutside.push(circleSegmentOutside);\n\n            } else {\n\n                circleObj.segmentsOutside.push({active: false});\n\n            }\n\n        }\n\n        circleHolder.push(circleObj);\n\n    }\n\n};\n\n\n\n\nfunction onResize() {\n\n    w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n    h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n\n    canvas.width = w;\n    canvas.height = h;\n\n    context.fillStyle = '#000000';\n    context.fillRect(0, 0, w, h);\n\n    imageData = context.getImageData(0, 0, w, h);\n    data = imageData.data;\n\n};\n\n\nfunction audioBtHandler(event) {\n\n    if (audio.paused) {\n\n        audio.play();\n\n        btStart.innerHTML = 'Pause Audio';\n\n    } else {\n\n        audio.pause();\n\n        btStart.innerHTML = 'Play Audio';\n\n    }\n\n};\n\n//---\n\nfunction mouseDownHandler(event) {\n\n    mouseDown = true;\n\n};\n\nfunction mouseUpHandler(event) {\n\n    mouseDown = false;\n\n};\n\nfunction mouseEnterHandler(event) {\n\n    mouseActive = true;\n\n};\n\nfunction mouseLeaveHandler(event) {\n\n    mouseActive = false;\n\n    //mousePos.x = w / 2;\n    //mousePos.y = h / 2;\n\n    mouseDown = false;\n\n};\n\nfunction mouseMoveHandler(event) {\n\n    mousePos = getMousePos(canvas, event);\n\n};\n\nfunction getMousePos(canvas, event) {\n\n    var rect = canvas.getBoundingClientRect();\n\n    return {x: event.clientX - rect.left, y: event.clientY - rect.top};\n\n};\n\n//---\n\nfunction render() {\n\n    var aa = false;\n\n    if (analyser) {\n\n        aa = true;\n\n    }\n\n    var frequencySource;\n\n    if (aa === true) {\n\n        frequencySource = new Uint8Array(analyser.frequencyBinCount);\n\n        analyser.getByteFrequencyData(frequencySource);\n\n    }\n\n    //---\n\n    var sortArray = false;\n\n    //---\n\n    var col = getRGBColor2(rgb);\n    var col2 = getRGBColor(rgb2);\n\n    limitRGBColor(col, 0.45);\n    limitRGBColor(col2, 0.25);\n\n    //---\n\n    for (var i = 0, l = circleHolder.length; i < l; i++) {\n\n        var circleObj = circleHolder[i];\n\n        circleObj.color.r = col.r - (circleObj.z + fov) / fov;\n        circleObj.color.g = col.g - (circleObj.z + fov) / fov;\n        circleObj.color.b = col.b - (circleObj.z + fov) / fov;\n\n        //circleObj.color.r = Math.floor( ( ( ( col.r - circleObj.z + fov ) ) + ( col2.r - circleObj.z + fov ) ) / 2 );\n        //circleObj.color.g = Math.floor( ( ( ( col.g - circleObj.z + fov ) ) + ( col2.g - circleObj.z + fov ) ) / 2 );\n        //circleObj.color.b = Math.floor( ( ( ( col.b - circleObj.z + fov ) ) + ( col2.b - circleObj.z + fov ) ) / 2 );\n\n\n        if (circleObj.color.r < col2.r) {\n\n            circleObj.color.r = col2.r;\n\n        }\n\n        if (circleObj.color.g < col2.g) {\n\n            circleObj.color.g = col2.g;\n\n        }\n\n        if (circleObj.color.b < col2.b) {\n\n            circleObj.color.b = col2.b;\n\n        }\n\n\n        var circleObjBack;\n\n        if (i > 0) {\n\n            circleObjBack = circleHolder[i - 1];\n\n        }\n\n        //---\n\n        if (mouseActive) {\n\n            circleObj.mp = mousePos;\n\n        } else {\n\n            circleObj.mp.x += ((w / 2) - circleObj.mp.x) * 0.00025;\n            circleObj.mp.y += ((h / 2) - circleObj.mp.y) * 0.00025;\n\n        }\n\n        //circleObj.center.x = ( ( w / 2 ) - circleObj.mp.x ) * ( -i / 150 ) + w / 2;\n        //circleObj.center.y = ( ( h / 2 ) - circleObj.mp.y ) * ( -i / 150 ) + h / 2;\n\n        circleObj.center.x = ((w / 2) - circleObj.mp.x) * ((circleObj.z - fov) / 500) + w / 2;\n        circleObj.center.y = ((h / 2) - circleObj.mp.y) * ((circleObj.z - fov) / 500) + h / 2;\n\n        //---\n\n        if (aa === true) {\n\n            //var f = frequencySource[ Math.floor(circleObj.z + fov) ];\n            //var f = frequencySource[ i ];\n            //var f = frequencySource[ circleObj.audioIndex ];\n            //var fAdd = (f / 25);// * ( (circleObj.z - fov) / 200 );\n\n            //circleObj.radiusAudio = fAdd;\n\n        }\n\n        //---\n\n        for (var j = 0, k = circleObj.segmentsOutside.length; j < k; j++) {\n\n            var circleSegmentOutside = circleObj.segmentsOutside[j];\n\n            if (circleSegmentOutside.active === true) {\n\n                //---\n\n                var scale = fov / (fov + circleObj.z);\n                var scaleBack;\n\n                if (i > 0) {\n\n                    scaleBack = fov / (fov + circleObjBack.z);\n\n                }\n\n                var frequency, frequencyAdd;\n\n                circleSegmentOutside.x2d = (circleSegmentOutside.x * scale) + circleObj.center.x;\n                circleSegmentOutside.y2d = (circleSegmentOutside.y * scale) + circleObj.center.y;\n\n                //---\n\n                if (aa === true) {\n\n                    frequency = frequencySource[circleSegmentOutside.audioBufferIndex];\n                    frequencyAdd = frequency / 20;\n\n                    //---\n\n                    circleSegmentOutside.radiusAudio = circleSegmentOutside.radius - frequencyAdd;\n\n                }\n\n                //---\n\n                var lineColorValue = 0;\n\n                if (j > 0) {\n\n                    if (aa === true && audio.paused === false) {\n\n                        lineColorValue = Math.round(i / l * (55 + frequency));//255\n\n                        if (lineColorValue > 255) {\n\n                            lineColorValue = 255;\n\n                        }\n\n                    } else {\n\n                        lineColorValue = Math.round(i / l * 200);//255\n\n                    }\n\n                }\n\n                //---\n\n                if (i > 0 && i < l - 1) {\n\n                    var sub1 = circleSegmentOutside.subs[0];\n                    var sub1angle = sub1.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub1.x2d = (sub1.x * scale) + circleObj.center.x;\n                    sub1.y2d = (sub1.y * scale) + circleObj.center.y;\n                    sub1.x = circleObj.circleCenter.x + Math.cos(sub1angle) * circleSegmentOutside.radiusAudio;\n                    sub1.y = circleObj.circleCenter.y + Math.sin(sub1angle) * circleSegmentOutside.radiusAudio;\n\n                    var sub2 = circleSegmentOutside.subs[1];\n                    var sub2angle = sub2.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub2.x2d = (sub2.x * scaleBack) + circleObjBack.center.x;\n                    sub2.y2d = (sub2.y * scaleBack) + circleObjBack.center.y;\n                    sub2.x = circleObj.circleCenter.x + Math.cos(sub2angle) * circleSegmentOutside.radiusAudio;\n                    sub2.y = circleObj.circleCenter.y + Math.sin(sub2angle) * circleSegmentOutside.radiusAudio;\n\n                    var sub3 = circleSegmentOutside.subs[2];\n                    var sub3angle = sub3.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub3.x2d = (sub3.x * scaleBack) + circleObjBack.center.x;\n                    sub3.y2d = (sub3.y * scaleBack) + circleObjBack.center.y;\n                    sub3.x = circleObj.circleCenter.x + Math.cos(sub3angle) * circleSegmentOutside.radiusAudio;\n                    sub3.y = circleObj.circleCenter.y + Math.sin(sub3angle) * circleSegmentOutside.radiusAudio;\n\n                    var sub4 = circleSegmentOutside.subs[3];\n                    var sub4angle = sub4.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub4.x2d = (sub4.x * scale) + circleObj.center.x;\n                    sub4.y2d = (sub4.y * scale) + circleObj.center.y;\n                    sub4.x = circleObj.circleCenter.x + Math.cos(sub4angle) * circleSegmentOutside.radius;\n                    sub4.y = circleObj.circleCenter.y + Math.sin(sub4angle) * circleSegmentOutside.radius;\n\n                    var sub5 = circleSegmentOutside.subs[4];\n                    var sub5angle = sub5.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub5.x2d = (sub5.x * scale) + circleObj.center.x;\n                    sub5.y2d = (sub5.y * scale) + circleObj.center.y;\n                    sub5.x = circleObj.circleCenter.x + Math.cos(sub5angle) * circleSegmentOutside.radius;\n                    sub5.y = circleObj.circleCenter.y + Math.sin(sub5angle) * circleSegmentOutside.radius;\n\n                    var sub6 = circleSegmentOutside.subs[5];\n                    var sub6angle = sub6.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub6.x2d = (sub6.x * scaleBack) + circleObjBack.center.x;\n                    sub6.y2d = (sub6.y * scaleBack) + circleObjBack.center.y;\n                    sub6.x = circleObj.circleCenter.x + Math.cos(sub6angle) * circleSegmentOutside.radius;\n                    sub6.y = circleObj.circleCenter.y + Math.sin(sub6angle) * circleSegmentOutside.radius;\n\n                    var sub7 = circleSegmentOutside.subs[6];\n                    var sub7angle = sub7.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n                    sub7.x2d = (sub7.x * scaleBack) + circleObjBack.center.x;\n                    sub7.y2d = (sub7.y * scaleBack) + circleObjBack.center.y;\n                    sub7.x = circleObj.circleCenter.x + Math.cos(sub7angle) * circleSegmentOutside.radius;\n                    sub7.y = circleObj.circleCenter.y + Math.sin(sub7angle) * circleSegmentOutside.radius;\n\n                    var p1;\n                    var p2;\n                    var p3;\n                    var p4;\n\n                    var p5 = circleSegmentOutside.subs[3];\n                    var p6 = circleSegmentOutside.subs[4];\n                    var p7 = circleSegmentOutside.subs[6];\n                    var p8 = circleSegmentOutside.subs[5];\n\n                    if (frequencyAdd > 0) {\n\n                        p1 = circleSegmentOutside;\n                        p2 = circleSegmentOutside.subs[1];\n                        p3 = circleSegmentOutside.subs[2];\n                        p4 = circleSegmentOutside.subs[0];\n\n                    }\n\n                    var cr = Math.round(circleObj.color.r * lineColorValue);\n                    var cg = Math.round(circleObj.color.g * lineColorValue);\n                    var cb = Math.round(circleObj.color.b * lineColorValue);\n\n                    if (frequencyAdd > 0) {\n\n                        drawLine(p1.x2d | 0, p1.y2d | 0, p2.x2d | 0, p2.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p2.x2d | 0, p2.y2d | 0, p3.x2d | 0, p3.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p3.x2d | 0, p3.y2d | 0, p4.x2d | 0, p4.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p4.x2d | 0, p4.y2d | 0, p1.x2d | 0, p1.y2d | 0, cr, cg, cb, 255);\n\n                        drawLine(p5.x2d | 0, p5.y2d | 0, p1.x2d | 0, p1.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p6.x2d | 0, p6.y2d | 0, p4.x2d | 0, p4.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p7.x2d | 0, p7.y2d | 0, p3.x2d | 0, p3.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p8.x2d | 0, p8.y2d | 0, p2.x2d | 0, p2.y2d | 0, cr, cg, cb, 255);\n\n                    }\n\n                    if (circleObj.z < fov / 2) {\n\n                        drawLine(p5.x2d | 0, p5.y2d | 0, p6.x2d | 0, p6.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p6.x2d | 0, p6.y2d | 0, p7.x2d | 0, p7.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p7.x2d | 0, p7.y2d | 0, p8.x2d | 0, p8.y2d | 0, cr, cg, cb, 255);\n                        drawLine(p8.x2d | 0, p8.y2d | 0, p5.x2d | 0, p5.y2d | 0, cr, cg, cb, 255);\n\n                    }\n\n                }\n\n                //---\n\n                var circleSegmentOutsideangle;\n\n                //if ( j < k - 1 ) {\n\n                circleSegmentOutsideangle = circleSegmentOutside.index * (MATHPI2 / circleSegmentOutside.segments) + time;\n\n                circleSegmentOutside.x = circleObj.circleCenter.x + Math.cos(circleSegmentOutsideangle) * circleSegmentOutside.radiusAudio;\n                circleSegmentOutside.y = circleObj.circleCenter.y + Math.sin(circleSegmentOutsideangle) * circleSegmentOutside.radiusAudio;\n\n                /*} else {\n\n                  var circleSegmentOutside1 = circleObj.segmentsOutside[ 0 ];\n\n                  circleSegmentOutsideangle = circleSegmentOutside1.index * ( MATHPI2 / circleSegmentOutside1.segments ) + time;\n\n                  circleSegmentOutside.x = circleObj.circleCenter.x + Math.cos( circleSegmentOutsideangle ) * circleSegmentOutside1.radiusAudio;\n                  circleSegmentOutside.y = circleObj.circleCenter.y + Math.sin( circleSegmentOutsideangle ) * circleSegmentOutside1.radiusAudio;\n\n                   }\n                */\n\n\n                //---\n                /*\n              if ( i > 0 && i < l - 1 ) {\n              //if ( i > 0 && i < l - 1 && j < k - 1 ) {\n\n                var circleSegmentOutsideLineBack;// = circleObjBack[ j ];\n                var circleSegmentInsideLineBack;\n\n                //if ( j === 0 ) {\n\n                  //pB = circleObjBack.segments[ circleObjBack.segments.length - 1 ];\n\n                //} else {\n\n                  //pB = circleObjBack.segments[ j - 1 ];\n\n                //}\n\n                circleSegmentOutsideLineBack = circleObjBack.segmentsOutside[ j ];\n                circleSegmentInsideLineBack = circleObjBack.segmentsInside[ j ];\n\n                //drawLine( circleSegmentOutside.x2d | 0, circleSegmentOutside.y2d | 0, circleSegmentOutsideLineBack.x2d | 0, circleSegmentOutsideLineBack.y2d | 0, 0, Math.round( lineColorValue / 2 ), lineColorValue, 255 );\n                //drawLine( circleSegmentInside.x2d | 0, circleSegmentInside.y2d | 0, circleSegmentInsideLineBack.x2d | 0, circleSegmentInsideLineBack.y2d | 0, 0, Math.round( lineColorValue / 2 ), lineColorValue, 255 );\n\n              }\n              */\n\n\n            }\n\n        }\n\n        if (mouseDown) {\n\n            circleObj.z += speed;\n\n            if (circleObj.z > fov) {\n\n                circleObj.z -= (fov * 2);\n\n                sortArray = true;\n\n            }\n\n        } else {\n\n            circleObj.z -= speed;\n\n            if (circleObj.z < -fov) {\n\n                circleObj.z += (fov * 2);\n\n                sortArray = true;\n\n            }\n\n        }\n\n    }\n\n    //---\n\n    if (sortArray) {\n\n        circleHolder = circleHolder.sort(function (a, b) {\n\n            return (b.z - a.z);\n\n        });\n\n    }\n\n    //---\n\n    if (mouseDown) {\n\n        time -= 0.005;\n\n    } else {\n\n        time += 0.005;\n\n    }\n\n    //---\n\n    //soft invert colors\n    if (mouseDown) {\n\n        if (colorInvertValue < 255)\n            colorInvertValue += 5;\n        else\n            colorInvertValue = 255;\n\n        softInvert(colorInvertValue);\n\n    } else {\n\n        if (colorInvertValue > 0)\n            colorInvertValue -= 5;\n        else\n            colorInvertValue = 0;\n\n        if (colorInvertValue > 0)\n            softInvert(colorInvertValue);\n\n    }\n\n};\n\n//---\n\nfunction softInvert(value) {\n\n    for (var j = 0, n = data.length; j < n; j += 4) {\n\n        data[j] = Math.abs(value - data[j]);     // red\n        data[j + 1] = Math.abs(value - data[j + 1]); // green\n        data[j + 2] = Math.abs(value - data[j + 2]); // blue\n        data[j + 3] = 255;// - data[ j + 3 ]; // alpha\n\n    }\n\n};\n\n//---\n\nfunction animate() {\n\n    clearImageData();\n\n    render();\n\n    context.putImageData(imageData, 0, 0);\n\n    requestAnimationFrame(animate);\n\n};\n\nwindow.requestAnimFrame = (function () {\n\n    return window.requestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        function (callback) {\n            window.setTimeout(callback, 1000 / 60);\n        };\n\n})();"]},"metadata":{},"sourceType":"module"}